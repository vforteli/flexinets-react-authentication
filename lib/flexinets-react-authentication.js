module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)r.d(n,u,function(t){return e[t]}.bind(null,u));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=s(r(2)),o=s(r(3)),a=s(r(4));function s(e){return e&&e.__esModule?e:{default:e}}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(u,o){try{var a=t[u](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var c="https://authentication.flexinets.se";o.default.defaults.validateStatus=function(e){return e>=200&&e<500},o.default.interceptors.request.use(function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.authInterceptor(t));case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}());var l=null,f=null,p=null,d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"setBaseUrl",value:function(e){c=e}},{key:"getLoginUrl",value:function(){return c+"/token"}},{key:"getLogoutUrl",value:function(){return c+"/logout"}},{key:"getAccountUrl",value:function(){return c+"/api/account/"}},{key:"login",value:function(){var e=i(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearTokenContext(),e.next=3,(0,o.default)({method:"post",url:this.getLoginUrl(),data:a.default.stringify({grant_type:"password",username:t,password:r}),config:{headers:{"Content-Type":"application/x-www-form-urlencoded"}}});case 3:return 200===(n=e.sent).status&&this.setJwtToken(n.data),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"beginReset",value:function(){var e=i(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.default)({method:"post",url:this.getAccountUrl()+"resetpassword/beginreset/",data:{EmailAddress:t,ReturnUrl:r}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"completeReset",value:function(){var e=i(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.default)({method:"post",url:this.getAccountUrl()+"resetpassword/completereset/",data:{password:t,passwordConfirm:r,resetId:n}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"validateResetToken",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.default.get(this.getAccountUrl()+"resetpassword/validateresettoken/"+t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"authInterceptor",value:function(){var e=i(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.url.indexOf(this.getLoginUrl())>=0||t.url.indexOf(this.getLogoutUrl())>=0)){e.next=5;break}console.debug("withCredentials enabled for request"),t.withCredentials=!0,e.next=9;break;case 5:return e.next=7,this.getRefreshedAccessToken();case 7:null!==(r=e.sent)&&(t.headers.authorization="Bearer "+r);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearTokenContext(),e.next=3,o.default.post(this.getLogoutUrl());case 3:console.debug("Logged out");case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isLoggedIn",value:function(){var e=this.getJwtToken();return null!==e&&e.refresh_token_expires>(new Date).getTime()/1e3}},{key:"getCurrentUser",value:function(){if(null===f){var e=this.getJwtToken();if(null!==e)try{var t=(0,u.default)(e.access_token);f={EmailAddress:t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"],FirstName:t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname"],LastName:t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname"],Roles:t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],isInRole:function(e){return this.Roles.indexOf(e)>=0},settings:{}}}catch(e){console.debug("unable to parse token")}}return f}},{key:"getRefreshedAccessToken",value:function(){var e=i(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getJwtToken(),e.prev=1,null===t){e.next=10;break}if(!this.isJwtTokenExpired(t.access_token)){e.next=9;break}return console.debug("Token has expired, start refresh maybe"),e.next=7,this.refreshAccessToken();case 7:r=e.sent,console.debug("token refresh result "+r);case 9:return e.abrupt("return",this.getJwtToken().access_token);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),console.debug(e.t0),this.clearTokenContext();case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"checkEmailAvailability",value:function(){var e=i(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.default.get(c+"/api/checkemailavailability?email="+t);case 2:return r=e.sent,e.abrupt("return",r.data.available);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setJwtToken",value:function(e){localStorage.setItem("react_token",JSON.stringify(e)),l=e}},{key:"getJwtToken",value:function(){return null===l&&(console.debug("getting token from localstorage"),l=JSON.parse(localStorage.getItem("react_token"))),l}},{key:"refreshAccessToken",value:function(){var e=i(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("Refreshing access token"),null===p&&(console.debug("No pending access token refresh, starting new"),p=(0,o.default)({method:"post",url:this.getLoginUrl(),data:a.default.stringify({grant_type:"refresh_token"}),config:{headers:{"Content-Type":"application/x-www-form-urlencoded"}}}).then(function(e){return 200===e.status?(console.debug("Refreshed access token"),t.setJwtToken(e.data),!0):(t.clearTokenContext(),!1)}).catch(function(e){return console.debug(e),t.clearTokenContext(),!1}).finally(function(){return p=null})),e.abrupt("return",p);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"clearTokenContext",value:function(){console.debug("clearing token context"),localStorage.removeItem("react_token"),l=null,f=null}},{key:"isJwtTokenExpired",value:function(e){var t=(0,u.default)(e);if(!t.exp)return null;var r=new Date(0);return r.setUTCSeconds(t.exp),r<new Date}}]),e}();t.default=d},function(e,t){e.exports=require("jwt-decode")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("qs")}]);