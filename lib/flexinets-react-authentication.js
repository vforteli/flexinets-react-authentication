module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)r.d(n,u,function(t){return e[t]}.bind(null,u));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkEmailAvailability=t.getRefreshedAccessToken=t.logout=t.authInterceptor=t.beginReset=t.login=t.ACCOUNT_URL=void 0;t.login=function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return w(),e.next=3,(0,i.default)({method:"post",url:d,data:s.default.stringify({grant_type:"password",username:t,password:r}),config:{headers:{"Content-Type":"application/x-www-form-urlencoded"}}});case 3:return 200===(n=e.sent).status&&x(n.data),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),t.beginReset=function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.default)({method:"post",url:m+"/resetpassword/beginreset/",data:{EmailAddress:t,ReturnUrl:r}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}();var n=t.authInterceptor=function(){var e=l(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.url.indexOf(d)>=0||t.url.indexOf(g)>=0)){e.next=4;break}t.withCredentials=!0,e.next=8;break;case 4:return e.next=6,u();case 6:null!==(r=e.sent)&&(t.headers.authorization="Bearer "+r);case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),u=(t.logout=function(){var e=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return w(),e.next=3,i.default.post(g);case 3:console.debug("Logged out");case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.getRefreshedAccessToken=function(){var e=l(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=y())){e.next=9;break}if(!k(t.access_token)){e.next=8;break}return console.debug("Token has expired, start refresh maybe"),e.next=6,a();case 6:r=e.sent,console.debug("token refresh result "+r);case 8:return e.abrupt("return",y().access_token);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()),a=(t.checkEmailAvailability=function(){var e=l(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.get(f+"/api/checkemailavailability?email="+t);case 2:return r=e.sent,e.abrupt("return",r.data.available);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("Refreshing access token"),null===b&&(console.debug("No pending access token refresh, starting new"),b=(0,i.default)({method:"post",url:d,data:s.default.stringify({grant_type:"refresh_token"}),config:{headers:{"Content-Type":"application/x-www-form-urlencoded"}}}).then(function(e){return console.debug("Refreshed access token"),x(e.data),!0}).catch(function(e){if(console.debug(e),"invalid_grant"===e.response.data.error)return console.debug("Refresh token expired or invalidated"),w(),!1}).finally(function(){return b=null})),e.abrupt("return",b);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}());t.isLoggedIn=function(){var e=y();return null!==e&&e.refresh_token_expires>(new Date).getTime()/1e3},t.getCurrentUser=function(){if(null===v){var e=y();if(null!==e)try{var t=(0,o.default)(e.access_token);v={EmailAddress:t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"],FirstName:t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname"],LastName:t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname"],Roles:t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],isInRole:function(e){return this.Roles.indexOf(e)>=0},settings:{}}}catch(e){console.debug("unable to parse token")}}return v};var o=c(r(2)),i=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(u,a){try{var o=t[u](a),i=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}("next")})}}var f="http://localhost:65138",p="react_token",d=f+"/token",g=f+"/logout",m=t.ACCOUNT_URL=f+"/api/account/",h=null,v=null,b=null;function x(e){localStorage.setItem(p,JSON.stringify(e)),h=e}function y(){return null===h&&(console.debug("getting token from localstorage"),h=JSON.parse(localStorage.getItem(p))),h}function w(){console.debug("clearing token context"),localStorage.removeItem(p),h=null,v=null}function k(e){var t=(0,o.default)(e);if(!t.exp)return null;var r=new Date(0);return r.setUTCSeconds(t.exp),r<new Date}i.default.defaults.validateStatus=function(e){return e>=200&&e<500},i.default.interceptors.request.use(function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n(t));case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}())},function(e,t){e.exports=require("jwt-decode")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("qs")}]);